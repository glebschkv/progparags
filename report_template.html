<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMP2221 Systems Programming - Summative Report</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #000;
            max-width: 21cm;
            margin: 0 auto;
            padding: 2cm;
        }

        .page {
            page-break-after: always;
            min-height: 24cm;
            padding-bottom: 1cm;
        }

        .page:last-child {
            page-break-after: avoid;
        }

        h1 {
            font-size: 14pt;
            font-weight: bold;
            text-align: center;
            margin-bottom: 0.5cm;
            border-bottom: 2px solid #000;
            padding-bottom: 0.3cm;
        }

        h2 {
            font-size: 12pt;
            font-weight: bold;
            margin-top: 0.4cm;
            margin-bottom: 0.2cm;
            color: #000;
        }

        h3 {
            font-size: 11pt;
            font-weight: bold;
            margin-top: 0.3cm;
            margin-bottom: 0.15cm;
        }

        p, li {
            font-size: 10pt;
            margin-bottom: 0.15cm;
            text-align: justify;
        }

        ul {
            margin-left: 0.5cm;
            padding-left: 0.5cm;
        }

        li {
            margin-bottom: 0.1cm;
        }

        .figure-placeholder {
            border: 2px dashed #666;
            padding: 1cm;
            margin: 0.4cm 0;
            text-align: center;
            background-color: #f9f9f9;
            min-height: 4cm;
        }

        .figure-placeholder p {
            color: #666;
            font-style: italic;
            text-align: center;
            margin: 0;
        }

        .figure-caption {
            text-align: center;
            font-size: 9pt;
            font-style: italic;
            margin-top: 0.2cm;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.3cm 0;
            font-size: 9pt;
        }

        th, td {
            border: 1px solid #000;
            padding: 0.15cm 0.2cm;
            text-align: left;
        }

        th {
            background-color: #e0e0e0;
            font-weight: bold;
        }

        .code-ref {
            font-family: 'Courier New', monospace;
            font-size: 9pt;
            background-color: #f0f0f0;
            padding: 0.05cm 0.1cm;
        }

        .word-count {
            font-size: 8pt;
            color: #666;
            text-align: right;
            margin-top: 0.3cm;
            font-style: italic;
        }

        .header-info {
            text-align: center;
            margin-bottom: 0.5cm;
        }

        .header-info p {
            margin: 0.1cm 0;
            text-align: center;
        }

        .fill-in {
            color: #0066cc;
            font-weight: bold;
        }

        .note {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            padding: 0.3cm;
            margin: 0.3cm 0;
            font-size: 9pt;
        }

        @media print {
            body {
                padding: 0;
            }
            .note {
                display: none;
            }
            .fill-in {
                color: #000;
            }
        }
    </style>
</head>
<body>

<!-- ==================== PAGE 1 ==================== -->
<div class="page">
    <div class="header-info">
        <p><strong>COMP2221 Systems Programming - Summative Coursework</strong></p>
        <p>Student ID: <span class="fill-in">[YOUR STUDENT ID]</span></p>
    </div>

    <h1>Section 1: Summary of Approach & Solution Design</h1>

    <div class="note">
        <strong>Instructions:</strong> Max 250 words. Figures/tables don't count toward word limit. Include hand-drawn diagrams. Reference specific code lines.
    </div>

    <h2>Problem Definition</h2>
    <p>
        The allocator manages memory for Mars Rover systems facing radiation storms (random bit-flips) and brownout events (power loss during writes). Unlike standard malloc implementations assuming reliable hardware, this solution designs defensively, assuming failure will occur.
    </p>

    <h2>Core Design</h2>
    <ul>
        <li><strong>Implicit free list</strong> with boundary tag coalescing for block management (<span class="code-ref">allocator.c:330-375</span>)</li>
        <li><strong>Quadruple-redundant size storage</strong> enabling majority voting recovery from corruption</li>
        <li><strong>Three-state commit protocol</strong> detecting interrupted write operations (<span class="code-ref">allocator.c:65-67</span>)</li>
        <li><strong>Block quarantine system</strong> permanently isolating corrupted memory (<span class="code-ref">allocator.c:79-100</span>)</li>
    </ul>

    <h2>Data Structures</h2>
    <p>
        The Header (40 bytes, <span class="code-ref">allocator.c:38-50</span>) contains: magic number (0xDEADBEEF), checksum, size with backup copy, allocation flag, payload checksum, write state, and requested size. The Footer (24 bytes, <span class="code-ref">allocator.c:52-60</span>) contains: magic (0xCAFEBABE), checksum, and redundant size copies for boundary tag coalescing.
    </p>

    <h2>Fault Resilience Mechanisms</h2>
    <ul>
        <li>Rotational XOR checksums with prime-number bit rotations detect single bit-flips with >99% probability (<span class="code-ref">allocator.c:122-145</span>)</li>
        <li>Three-state protocol: STATE_UNWRITTEN→STATE_WRITING→STATE_WRITTEN tracks write completion</li>
        <li>Corrupted blocks quarantined rather than recovered, preventing cascade failures</li>
    </ul>

    <h2>Memory Layout</h2>
    <p>
        Each block follows: [Header][Padding][Payload][Footer]. Padding (0-8 bytes) ensures 40-byte payload alignment calculated at <span class="code-ref">allocator.c:300-310</span>. Minimum data area of 48 bytes prevents unusably small fragments.
    </p>

    <!-- FIGURE 1 -->
    <div class="figure-placeholder">
        <p><strong>INSERT HAND-DRAWN FIGURE 1 HERE</strong></p>
        <p>Block structure showing Header (40B) / Padding / Payload / Footer (24B)</p>
        <p>Label all fields and sizes</p>
    </div>
    <p class="figure-caption">Figure 1: Memory block structure with quadruple-redundant size storage</p>

    <!-- FIGURE 2 -->
    <div class="figure-placeholder">
        <p><strong>INSERT HAND-DRAWN FIGURE 2 HERE</strong></p>
        <p>Three-state write protocol state machine</p>
        <p>Show: UNWRITTEN → WRITING → WRITTEN with brownout detection branch</p>
    </div>
    <p class="figure-caption">Figure 2: Three-state commit protocol for brownout detection</p>

    <p class="word-count">Word count: ~248/250 (excluding figures and captions)</p>
</div>

<!-- ==================== PAGE 2 ==================== -->
<div class="page">
    <h1>Section 2: Analysis of Solution</h1>

    <div class="note">
        <strong>Instructions:</strong> Max 250 words. Include qualitative AND quantitative analysis. Reference specific code. Use tables for data.
    </div>

    <h2>Time Complexity Analysis</h2>

    <table>
        <tr>
            <th>Function</th>
            <th>Best Case</th>
            <th>Worst Case</th>
            <th>Dominant Operation</th>
        </tr>
        <tr>
            <td>mm_malloc</td>
            <td>O(1)</td>
            <td>O(n²)</td>
            <td>Free block search + coalescing retry</td>
        </tr>
        <tr>
            <td>mm_free</td>
            <td>O(n)</td>
            <td>O(n)</td>
            <td>Immediate coalescing scan</td>
        </tr>
        <tr>
            <td>mm_read/write</td>
            <td>O(k)</td>
            <td>O(k)</td>
            <td>Payload checksum (k=payload size)</td>
        </tr>
    </table>
    <p class="figure-caption">Table 1: Time complexity analysis (n=blocks in heap, k=payload size)</p>

    <p>
        Code references: malloc search (<span class="code-ref">allocator.c:400-430</span>), coalescing (<span class="code-ref">allocator.c:330-375</span>), checksum computation (<span class="code-ref">allocator.c:147-158</span>).
    </p>

    <h2>Space Overhead Analysis</h2>

    <table>
        <tr>
            <th>Allocation Size</th>
            <th>Block Overhead</th>
            <th>Overhead %</th>
        </tr>
        <tr>
            <td>48 bytes</td>
            <td>~72 bytes</td>
            <td>60%</td>
        </tr>
        <tr>
            <td>256 bytes</td>
            <td>~72 bytes</td>
            <td>22%</td>
        </tr>
        <tr>
            <td>1024 bytes</td>
            <td>~72 bytes</td>
            <td>7%</td>
        </tr>
    </table>
    <p class="figure-caption">Table 2: Fixed per-block overhead (40B header + 24B footer + 0-8B padding)</p>

    <h2>Key Trade-offs</h2>
    <ul>
        <li><strong>Quadruple size redundancy</strong> (+16 bytes/block): Enables majority voting recovery; justified for radiation-prone environment (<span class="code-ref">allocator.c:175-195</span>)</li>
        <li><strong>Payload checksums</strong> (O(n) per access): Detects data corruption, not just metadata; essential for scientific data integrity (<span class="code-ref">allocator.c:147-158</span>)</li>
        <li><strong>Immediate coalescing</strong> (O(n) per free): Prevents fragmentation accumulation; trades speed for memory efficiency (<span class="code-ref">allocator.c:330-375</span>)</li>
        <li><strong>Block quarantine</strong> (memory loss): Guarantees corrupted data never returned; conservative but safe for Mars mission (<span class="code-ref">allocator.c:92-100</span>)</li>
        <li><strong>Implicit free list</strong> (O(n) search): Fewer pointers mean fewer corruption points; simplicity improves reliability</li>
    </ul>

    <!-- FIGURE 3 -->
    <div class="figure-placeholder">
        <p><strong>INSERT HAND-DRAWN FIGURE 3 HERE</strong></p>
        <p>Graph: X-axis = Allocation size (48B to 4KB), Y-axis = Overhead % (0-70%)</p>
        <p>Show decreasing curve from 60% to ~2%</p>
    </div>
    <p class="figure-caption">Figure 3: Memory overhead percentage decreases as allocation size increases</p>

    <p class="word-count">Word count: ~247/250 (excluding tables and figures)</p>
</div>

<!-- ==================== PAGE 3 ==================== -->
<div class="page">
    <h1>Section 3: Use of Generative AI, Tools, or other Resources</h1>

    <div class="note">
        <strong>Instructions:</strong> Max 250 words. Be HONEST about AI usage. Explain how tools helped AND hindered. Describe what was reused vs original.
    </div>

    <h2>Development Tools</h2>

    <h3>GCC Compiler (<span class="code-ref">-Wall -Wextra -Werror</span>)</h3>
    <ul>
        <li>Caught implicit integer conversions between <span class="code-ref">size_t</span> and <span class="code-ref">uint32_t</span></li>
        <li>Identified potential buffer overflows in checksum loops</li>
        <li>Added explicit casts at <span class="code-ref">allocator.c:130, 142, 156</span></li>
    </ul>

    <h3>GDB Debugger</h3>
    <ul>
        <li>Traced <span class="code-ref">find_block_header()</span> pointer resolution issues</li>
        <li>Discovered padding calculation error; fixed at <span class="code-ref">allocator.c:305-310</span></li>
        <li>Watched write_state transitions during brownout simulation</li>
    </ul>

    <h3>Valgrind</h3>
    <ul>
        <li>Verified no memory leaks in test harness</li>
        <li>Detected uninitialised reads during development</li>
        <li>Limited use since we're implementing malloc itself</li>
    </ul>

    <h2>Reference Materials</h2>
    <ul>
        <li><strong>"Computer Systems: A Programmer's Perspective"</strong>: Boundary tag coalescing pattern, implicit free list concepts</li>
        <li><strong>Database transaction theory</strong>: Three-state commit protocol inspired by write-ahead logging</li>
        <li><strong>OWASP guidelines</strong>: Integer overflow prevention, bounds checking patterns</li>
    </ul>

    <h2>Generative AI Usage</h2>
    <p class="fill-in">
        [WRITE YOUR HONEST AI USAGE HERE - Examples below:]
    </p>
    <ul>
        <li><span class="fill-in">[If used: "AI assisted with explaining checksum algorithm options and debugging specific validation failures. Suggestions assumed reliable hardware, requiring significant modification to add fault tolerance."]</span></li>
        <li><span class="fill-in">[If not used: "No generative AI tools were used. Solution developed using lecture materials, textbook references, and manual debugging."]</span></li>
    </ul>

    <h2>Reused Elements</h2>

    <table>
        <tr>
            <th>Element</th>
            <th>Source</th>
            <th>Modification Made</th>
        </tr>
        <tr>
            <td>Boundary tags</td>
            <td>CS:APP textbook</td>
            <td>Added redundant size fields</td>
        </tr>
        <tr>
            <td>XOR checksums</td>
            <td>Algorithm theory</td>
            <td>Added prime rotations</td>
        </tr>
        <tr>
            <td>Commit protocol</td>
            <td>Database concepts</td>
            <td>Adapted for memory writes</td>
        </tr>
    </table>
    <p class="figure-caption">Table 3: Elements adapted from external sources</p>

    <p class="word-count">Word count: ~244/250 (excluding table)</p>
</div>

<!-- ==================== PAGE 4 ==================== -->
<div class="page">
    <h1>Section 4: Additional Functionality</h1>

    <div class="note">
        <strong>Instructions:</strong> Max 250 words. Define each feature clearly. Include hand-drawn diagrams. Reference specific code lines.
    </div>

    <h2>Feature 1: mm_realloc (<span class="code-ref">allocator.c:800-870</span>)</h2>
    <p>
        Resizes allocations while maintaining fault tolerance guarantees:
    </p>
    <ul>
        <li>NULL pointer returns <span class="code-ref">mm_malloc(new_size)</span></li>
        <li>Zero size calls <span class="code-ref">mm_free(ptr)</span>, returns NULL</li>
        <li><strong>In-place optimization</strong>: If new size fits current capacity, returns same pointer without copying</li>
        <li><strong>Full write protocol</strong>: New blocks use three-state commit during data migration</li>
        <li>If brownout occurs during copy, corruption is detectable; old block remains valid until free completes</li>
    </ul>

    <h2>Feature 2: Block Quarantine System (<span class="code-ref">allocator.c:79-100</span>)</h2>
    <p>
        Corrupted blocks permanently isolated rather than recovered:
    </p>
    <ul>
        <li>Array stores up to 64 quarantined block pointers (<span class="code-ref">MAX_QUARANTINE</span>)</li>
        <li><span class="code-ref">is_quarantined()</span> checks before every operation (<span class="code-ref">allocator.c:92-100</span>)</li>
        <li>Triggers: invalid magic, checksum mismatch, brownout state, size disagreement</li>
        <li><strong>Rationale</strong>: Recovery attempts could return partially corrupted data; for Mars scientific data, isolation is safer than uncertain recovery</li>
    </ul>

    <h2>Feature 3: Advanced Checksum Algorithm (<span class="code-ref">allocator.c:122-158</span>)</h2>
    <p>
        Rotational XOR with prime-number bit rotations:
    </p>
    <ul>
        <li>Different seeds prevent collision: header (0x5A5A5A5A), footer (0xA5A5A5A5), payload (0x12345678)</li>
        <li>Prime rotations (3,5,7,11,13,17,19,23,29 bits) maximize bit dispersion</li>
        <li><strong>Critical design</strong>: <span class="code-ref">write_state</span> excluded from header checksum (<span class="code-ref">allocator.c:133</span>), enabling brownout detection even when checksum appears invalid</li>
    </ul>

    <h2>Feature 4: Statistics Reporting (<span class="code-ref">allocator.c:880-927</span>)</h2>
    <p>
        Runtime introspection reporting: heap range, allocated bytes, corruption count, quarantine count, free block statistics. Enables ground control debugging and performance monitoring.
    </p>

    <!-- FIGURE 4 -->
    <div class="figure-placeholder">
        <p><strong>INSERT HAND-DRAWN FIGURE 4 HERE</strong></p>
        <p>Realloc decision flowchart: ptr==NULL? → malloc. size==0? → free.</p>
        <p>size≤capacity? → return same. Else → allocate, copy, free old</p>
    </div>
    <p class="figure-caption">Figure 4: mm_realloc decision flowchart</p>

    <!-- FIGURE 5 -->
    <div class="figure-placeholder">
        <p><strong>INSERT HAND-DRAWN FIGURE 5 HERE</strong></p>
        <p>Heap with blocks, some marked corrupted (X), arrows to quarantine list</p>
    </div>
    <p class="figure-caption">Figure 5: Block quarantine system architecture</p>

    <p class="word-count">Word count: ~249/250 (excluding figures)</p>
</div>

</body>
</html>
